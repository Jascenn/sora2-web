'use client'

import { useState, useEffect } from 'react'
import { z } from 'zod'
import { Button } from '@/components/ui/button'
import { generateVideo } from '@/lib/video'

export default function LionGeneratePage() {
  const [url, setUrl] = useState('')
  const [style, setStyle] = useState('cinematic')
  const [aspectRatio, setAspectRatio] = useState('16:9')
  const [quality, setQuality] = useState('standard')
  const [isGenerating, setIsGenerating] = useState(false)
  const [progress, setProgress] = useState(0)
  const [status, setStatus] = useState<'idle' | 'generating' | 'completed' | 'error'>('idle')
  const [result, setResult] = useState<{ videoId?: string; url?: string } | null>(null)

  const generateSchema = z.object({
    url: z.string().url('è¯·è¾“å…¥è§†é¢‘URL'),
    style: z.enum(['cinematic', 'artistic', 'realistic', 'anime']).default('cinematic'),
    aspectRatio: z.enum(['16:9', '9:16', '1:1', '4:3']).default('16:9'),
    quality: z.enum(['standard', 'hd', '4k']).default('standard'),
  })

  const handleGenerate = async () => {
    if (!url) {
      setStatus('error')
      return
    }

    setIsGenerating(true)
    setProgress(0)
    setStatus('generating')

    try {
      const result = await generateVideo(url, {
        style,
        aspectRatio,
        quality,
      })

      setResult(result)
      setProgress(100)
      setStatus('completed')
    } catch (error) {
      console.error('ç”Ÿæˆå¤±è´¥:', error)
      setStatus('error')
      setResult(null)
    } finally {
      setIsGenerating(false)
    }
  }

  const handleCopyUrl = (videoUrl: string) => {
    navigator.clipboard.writeText(videoUrl)
    setStatus('completed')
  }

  return (
    <div className="min-h-screen bg-gradient-to-br from-gray-900 via-gray-800 to-gray-900 p-4">
      <div className="max-w-2xl mx-auto p-4">
        <div className="text-center">
          <h1 className="text-3xl font-bold text-white mb-8 bg-gradient-to-r from-purple-600 to-pink-600 bg-clip-text text-transparent">
            ğŸ¦ LionCC Video Generator
          </h1>
          <p className="text-gray-300 text-lg">
            é«˜è´¨é‡AIè§†é¢‘ç”Ÿæˆå·¥å…·ï¼Œæ”¯æŒå¤šç§é£æ ¼å’Œæ¯”ä¾‹
          </p>
        </div>

        {result ? (
          <div className="bg-white/10 backdrop-blur-sm rounded-lg p-6 shadow-xl">
            <div className="text-center">
              <div className="mb-4">
                <h2 className="text-2xl font-bold text-gray-900 mb-2">âœ… ç”Ÿæˆå®Œæˆ!</h2>
                {result.videoId && (
                  <p className="text-sm text-gray-600 mb-4">
                    è§†é¢‘ID: <span className="font-mono">{result.videoId}</span>
                  </p>
                )}
              </div>

              <div className="mb-6">
                <h3 className="text-lg font-semibold text-gray-900 mb-2">è§†é¢‘URL</h3>
                <div className="flex items-center space-x-2">
                  <input
                    type="url"
                    value={result.url}
                    readOnly
                    className="flex-1 p-2 bg-gray-100 rounded text-sm text-gray-900"
                    onClick={() => handleCopyUrl(result.url!)}
                  />
                  <Button
                    onClick={() => handleCopyUrl(result.url!)}
                    variant="outline"
                    size="sm"
                  >
                    å¤åˆ¶é“¾æ¥
                  </Button>
                </div>
              </div>

              <div className="mb-6">
                <h3 className="text-lg font-semibold text-gray-900 mb-2">æ“ä½œ</h3>
                <div className="flex space-x-2">
                  <Button
                    onClick={() => {
                      setResult(null)
                      setStatus('idle')
                      setProgress(0)
                    }}
                    variant="outline"
                  >
                    é‡æ–°ç”Ÿæˆ
                  </Button>
                  <Button
                    onClick={() => {
                      if (result.videoId) {
                        // è¿™é‡Œå¯ä»¥æ·»åŠ ä¸‹è½½åŠŸèƒ½
                        window.open(`/download/${result.videoId}`)
                      }
                    }}
                    variant="outline"
                  >
                    ä¸‹è½½
                  </Button>
                </div>
              </div>
            </div>
          </div>
        ) : (
          <form onSubmit={handleGenerate} className="space-y-4">
            <div className="mb-6">
              <h2 className="text-2xl font-bold text-gray-900 mb-4">ğŸ¦ ç”Ÿæˆè§†é¢‘</h2>

              <div className="space-y-4">
                <div>
                  <label htmlFor="url" className="block text-sm font-medium text-gray-700 mb-2">
                    è§†é¢‘URL
                  </label>
                  <input
                    id="url"
                    type="url"
                    value={url}
                    onChange={(e) => setUrl(e.target.value)}
                    placeholder="https://example.com/video.mp4"
                    className="w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-purple-500 sm:text-sm text-gray-900 placeholder-gray-400"
                    required
                  />
                </div>

                <div>
                  <label htmlFor="style" className="block text-sm font-medium text-gray-700 mb-2">
                    é£æ ¼
                  </label>
                  <select
                    id="style"
                    value={style}
                    onChange={(e) => setStyle(e.target.value)}
                    className="w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-purple-500 sm:text-sm text-gray-900"
                  >
                    <option value="cinematic">ç”µå½±é£æ ¼</option>
                    <option value="artistic">è‰ºæœ¯é£æ ¼</option>
                    <option value="realistic">å†™å®é£æ ¼</option>
                    <option value="anime">åŠ¨æ¼«é£æ ¼</option>
                  </select>
                </div>

                <div>
                  <label htmlFor="aspectRatio" className="block text-sm font-medium text-gray-700 mb-2">
                    æ¯”ä¾‹
                  </label>
                  <select
                    id="aspectRatio"
                    value={aspectRatio}
                    onChange={(e) => setAspectRatio(e.target.value)}
                    className="w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-purple-500 sm:text-sm text-gray-900"
                  >
                    <option value="16:9">å®½å± (16:9)</option>
                    <option value="9:16">ç«–å± (9:16)</option>
                    <option value="1:1">æ­£æ–¹å½¢ (1:1)</option>
                    <option value="4:3">æ‰‹æœºç«–å± (4:3)</option>
                  </select>
                </div>

                <div>
                  <label htmlFor="quality" className="block text-sm font-medium text-gray-700 mb-2">
                    è´¨é‡
                  </label>
                  <select
                    id="quality"
                    value={quality}
                    onChange={(e) => setQuality(e.target.value)}
                    className="w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-purple-500 sm:text-sm text-gray-900"
                  >
                    <option value="standard">æ ‡å‡†</option>
                    <option value="hd">é«˜æ¸…</option>
                    <option value="4k">è¶…é«˜æ¸…</option>
                  </select>
                </div>

                <Button
                  type="submit"
                  disabled={isGenerating}
                  className="w-full bg-gradient-to-r from-purple-600 to-pink-600 text-white font-medium py-3 px-4 rounded-md shadow-lg hover:from-purple-700 to-pink-800 focus:outline-none focus:ring-2 focus:ring-purple-500 disabled:opacity-50 cursor-not-allowed transition-all duration-200"
                >
                  {isGenerating ? (
                    <>
                      <div className="animate-spin rounded-full h-5 w-5 border-b-2 border-white border-t-transparent border-purple-500"></div>
                      <span>ç”Ÿæˆä¸­... {progress}%</span>
                    </>
                  ) : (
                    <>
                      <span className="mr-2">ğŸ¦</span>
                      ç”Ÿæˆè§†é¢‘
                    </>
                  )}
                </Button>
              </div>
            </div>
          </form>
        </div>
      </div>
    </div>
  )
}